<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Direct GitHub Stats Test</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background: #1a1a1a; 
            color: #fff; 
        }
        .stats-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 20px; 
            margin: 20px 0; 
        }
        .stat-card { 
            background: rgba(255, 255, 255, 0.1); 
            border: 1px solid rgba(255, 255, 255, 0.2); 
            border-radius: 10px; 
            padding: 20px; 
            text-align: center; 
        }
        .stat-card i { color: #ff6b35; margin-bottom: 10px; }
        .stat-card h3 { font-size: 2rem; margin: 10px 0; }
        .stat-card p { color: #ccc; }
        #main-language-stats { margin: 20px 0; }
        .language-item { margin: 10px 0; }
        .language-info { display: flex; justify-content: space-between; margin-bottom: 5px; }
        .language-dot { width: 12px; height: 12px; border-radius: 50%; display: inline-block; margin-right: 8px; }
        .language-bar { background: rgba(255,255,255,0.1); height: 6px; border-radius: 3px; }
        .language-bar-fill { height: 100%; border-radius: 3px; }
        .debug { background: #333; padding: 10px; margin: 10px 0; border-radius: 5px; font-family: monospace; }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <h1>Direct GitHub Stats Function Test</h1>
    
    <div id="debug-log"></div>
    
    <h2>Stats Grid</h2>
    <div class="stats-grid" id="stats-grid">
        <div class="stat-card">
            <p>Loading stats...</p>
        </div>
    </div>
    
    <h2>Main Language Stats</h2>
    <div id="main-language-stats">
        <p>Loading language stats...</p>
    </div>
    
    <h2>Contribution Graph</h2>
    <div id="contribution-graph">
        <p>Loading contribution graph...</p>
    </div>

    <script>
        function debugLog(message) {
            const log = document.getElementById('debug-log');
            const div = document.createElement('div');
            div.className = 'debug';
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            log.appendChild(div);
            console.log(message);
        }

        // Copy the exact GitHubAPIManager and loadGitHubStats from the main script
        class GitHubAPIManager {
            constructor(username = 'and3rn3t') {
                this.username = username;
                this.baseURL = 'https://api.github.com';
                this.cache = new Map();
                this.cachedData = null;
            }

            async loadCachedGitHubData() {
                if (this.cachedData) return this.cachedData;
                
                try {
                    const response = await fetch('github-data.json');
                    if (response.ok) {
                        this.cachedData = await response.json();
                        debugLog('‚úÖ Using pre-fetched GitHub data from: ' + this.cachedData.lastUpdated);
                        return this.cachedData;
                    }
                } catch (error) {
                    debugLog('‚ÑπÔ∏è Pre-fetched data not available, using direct API: ' + error.message);
                }
                return null;
            }

            async getUserData() {
                const cachedData = await this.loadCachedGitHubData();
                if (cachedData && cachedData.user) {
                    return cachedData.user;
                }
                throw new Error('No cached user data available');
            }

            async getRepositories(sort = 'stars', per_page = 100) {
                const cachedData = await this.loadCachedGitHubData();
                if (cachedData && cachedData.repositories) {
                    let repos = cachedData.repositories;
                    
                    if (sort === 'stars') {
                        repos = repos.sort((a, b) => b.stargazers_count - a.stargazers_count);
                    } else if (sort === 'updated') {
                        repos = repos.sort((a, b) => new Date(b.updated_at) - new Date(a.updated_at));
                    }
                    
                    return repos.slice(0, per_page);
                }
                throw new Error('No cached repository data available');
            }
        }

        const githubAPI = new GitHubAPIManager();

        async function loadGitHubStats() {
            debugLog('üìä Loading GitHub stats...');
            const statsGrid = document.getElementById('stats-grid');
            const contributionGraph = document.getElementById('contribution-graph');
            const languageStats = document.getElementById('main-language-stats');
            
            debugLog('DOM Elements found: ' + JSON.stringify({ 
                statsGrid: !!statsGrid, 
                contributionGraph: !!contributionGraph, 
                languageStats: !!languageStats 
            }));
            
            if (!statsGrid) {
                debugLog('‚ùå stats-grid element not found in DOM');
                return;
            }
            
            try {
                debugLog('üîÑ Fetching GitHub API data...');
                const [userData, repos] = await Promise.all([
                    githubAPI.getUserData(),
                    githubAPI.getRepositories('updated', 100)
                ]);
                
                debugLog('‚úÖ GitHub data received: ' + JSON.stringify({ 
                    user: userData?.login, 
                    repoCount: repos?.length,
                    usingCache: !!githubAPI.cachedData 
                }));

                const totalStars = repos.reduce((sum, repo) => sum + repo.stargazers_count, 0);
                const totalForks = repos.reduce((sum, repo) => sum + repo.forks_count, 0);
                
                debugLog('üìà Calculated stats: ' + JSON.stringify({ totalStars, totalForks }));
                
                const statsHTML = `
                    <div class="stat-card">
                        <i class="fas fa-code-branch"></i>
                        <div class="stat-content">
                            <h3>${userData.public_repos}</h3>
                            <p>Public Repositories</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-users"></i>
                        <div class="stat-content">
                            <h3>${userData.followers}</h3>
                            <p>Followers</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <i class="fas fa-star"></i>
                        <div class="stat-content">
                            <h3>${totalStars}</h3>
                            <p>Total Stars</p>
                        </div>
                    </div>
                `;
                
                debugLog('üé® Setting stats HTML to statsGrid element');
                statsGrid.innerHTML = statsHTML;
                
                // Load language statistics
                loadLanguageStats(repos);
                
                // Load contribution graph
                if (contributionGraph) {
                    contributionGraph.innerHTML = '<div class="contribution-widget"><img src="https://ghchart.rshah.org/f5576c/and3rn3t" alt="GitHub Contribution Graph" /></div>';
                }
                
            } catch (error) {
                debugLog('‚ùå Error loading GitHub stats: ' + error.message);
                console.error(error);
                if (statsGrid) {
                    statsGrid.innerHTML = '<p class="error-message">Unable to load GitHub statistics at this time.</p>';
                }
            }
        }

        function loadLanguageStats(repos) {
            const languageStats = document.getElementById('main-language-stats');
            debugLog('üè∑Ô∏è Loading language stats for element: ' + languageStats?.id + ' with ' + repos?.length + ' repos');
            
            if (!languageStats) {
                debugLog('‚ùå main-language-stats element not found');
                return;
            }
            
            const languages = {};
            for (const repo of repos) {
                if (repo.language) {
                    languages[repo.language] = (languages[repo.language] || 0) + 1;
                }
            }
            
            const sortedLanguages = Object.entries(languages)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 8);
            
            const total = sortedLanguages.reduce((sum, [, count]) => sum + count, 0);
            
            const languageColors = {
                'JavaScript': '#f1e05a',
                'Python': '#3572A5',
                'HTML': '#e34c26',
                'CSS': '#563d7c',
                'TypeScript': '#2b7489',
                'Java': '#b07219'
            };
            
            debugLog('üìä Language stats computed: ' + JSON.stringify({ sortedLanguages, total }));
            
            languageStats.innerHTML = `
                <div class="language-bars">
                    ${sortedLanguages.map(([language, count]) => {
                        const percentage = ((count / total) * 100).toFixed(1);
                        const color = languageColors[language] || '#8b949e';
                        return `
                            <div class="language-item">
                                <div class="language-info">
                                    <span class="language-name">
                                        <span class="language-dot" style="background-color: ${color}"></span>
                                        ${language}
                                    </span>
                                    <span class="language-percentage">${percentage}%</span>
                                </div>
                                <div class="language-bar">
                                    <div class="language-bar-fill" style="width: ${percentage}%; background-color: ${color}"></div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        // Test the function directly
        document.addEventListener('DOMContentLoaded', function() {
            debugLog('üöÄ DOM loaded, starting test...');
            loadGitHubStats().catch(error => {
                debugLog('‚ùå Test failed: ' + error.message);
            });
        });
    </script>
</body>
</html>